function changeURLParam(old,par,par_value){var pattern=par+"=([^&]*)",replaceText=par+"="+par_value;if(old.match(pattern)){var re=eval("/("+par+"=)([^&]*)/gi");return old.replace(re,replaceText)}return old.match("[?]")?old+"&"+replaceText:old+"?"+replaceText}function getUrlParam(e,n){var t=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),a=e.match(t);return null!=a?unescape(a[2]):null}function pageChange(e){window.location=changeURLParam(window.location.href,"page",e)}function loadVideoJsPlugin(){videojs.plugin("ABP",function(){function e(e){var n=this;if(this.danmuDiv=document.createElement("div"),this.danmuDiv.className="vjs-danmu",e.el().insertBefore(this.danmuDiv,e.el().getElementsByClassName("vjs-poster")[0]),this.danmuShowControl=document.createElement("div"),this.danmuShowControl.className="vjs-danmu-control vjs-menu-button vjs-control",this.danmuShowControlContent=document.createElement("span"),this.danmuShowControlContent.className="glyphicon glyphicon-align-right",this.danmuShowControl.appendChild(this.danmuShowControlContent),e.el().getElementsByClassName("vjs-control-bar")[0].appendChild(this.danmuShowControl),"undefined"!=typeof CommentManager){this.cmManager=new CommentManager(this.danmuDiv),this.cmManager.display=!0,this.cmManager.init(),this.cmManager.clear();var t=e.el().children[0],a=0;t.addEventListener("progress",function(){a==t.currentTime?(t.hasStalled=!0,n.cmManager.stopTimer()):a=t.currentTime}),t.addEventListener("timeupdate",function(){n.cmManager.display!==!1&&(t.hasStalled&&(n.cmManager.startTimer(),t.hasStalled=!1),n.cmManager.time(Math.floor(1e3*t.currentTime)))}),t.addEventListener("play",function(){n.cmManager.startTimer()}),t.addEventListener("pause",function(){n.cmManager.stopTimer()}),t.addEventListener("waiting",function(){n.cmManager.stopTimer()}),t.addEventListener("playing",function(){n.cmManager.startTimer()}),t.addEventListener("seeked",function(){n.cmManager.clear()}),window&&window.addEventListener("resize",function(){n.cmManager.setBounds()}),this.danmuShowControl.addEventListener("click",function(){1==n.cmManager.display?(n.cmManager.display=!1,n.cmManager.clear(),n.danmuShowControlContent.setAttribute("class","glyphicon glyphicon-ban-circle")):(n.cmManager.display=!0,n.danmuShowControlContent.setAttribute("class","glyphicon glyphicon-align-right"))}),this.load=function(e,n){null==n&&(n=function(){});var a;a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.open("GET",e,!0),a.send();var i=this.cmManager,o=t;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status)if("Microsoft Internet Explorer"==navigator.appName){var e=new ActiveXObject("Microsoft.XMLDOM");e.async=!1,e.loadXML(a.responseText),i.load(BilibiliParser(e)),i.seek(1e3*o.currentTime),n(!0)}else i.seek(1e3*o.currentTime),i.load(BilibiliParser(a.responseXML)),n(!0);else n(!1)}}}return this}this.danmu=new e(this)})}function getMp4(e,n){var t="http://comment.bilibili.cn/"+e+".xml";$.ajax({type:"GET",url:serviceUrl+"/video/"+e+"/"+n,dataType:"json",success:function(e){var n={type:"video/mp4",src:e.url};loadVideo(n,t)},error:function(){getFlv(e,t)}}),changeSelect(e)}function getFlv(e,n){$.ajax({type:"GET",url:serviceUrl+"/videoflv/"+e,dataType:"json",success:function(e){var t={type:"video/flv",src:e.url};loadVideo(t,n)},error:function(){showError("视频地址取得失败")}})}function showError(e){var n=$("#loading_dialog");n.fadeIn(),n.append("<p>"+e+"</p>")}function loadVideo(e,n){window.vjs||(window.vjs=videojs("danmu_player"));var t=window.vjs;t.src(e),t.danmu||t.ABP(),t.danmu.load(n)}function changeSource(e,n){var t=window.vjs;t.pause(),t.currentTime(0),t.src(e),t.danmu.load(n),t.ready(function(){this.one("loadeddata",videojs.bind(this,function(){this.currentTime(0)})),this.load(),this.play()})}function changeSelect(e){for(var n=$(".video_part_select"),t=0;t<n.length;t++){var a=n[t];a.getAttribute("cid")!=e?a.parentNode.classList.contains("disabled")&&a.parentNode.classList.remove("disabled"):a.parentNode.classList.add("disabled")}}$(document).ready(function(){$(".wb-show").hover(function(){$(this).find(".wb-show-shadow").stop().fadeTo(300,.8)},function(){$(this).find(".wb-show-shadow").stop().fadeTo(300,0)}),$(".wb_action_element").hover(function(){$(this).toggleClass("wb_element_active")},function(){$(this).toggleClass("wb_element_active")}),$(".wb_action_text").hover(function(){$(this).toggleClass("wb_text_active")},function(){$(this).toggleClass("wb_text_active")})});var serviceUrl="http://bilibili-service.daoapp.io";